<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
        <title>Hacking WebGL</title>
        
        <script src="js/gl-matrix-min.js"></script>
        <script src="https://cdn.babylonjs.com/babylon.js"></script>
        <script src="https://code.jquery.com/pep/0.4.1/pep.js"></script>

        <link rel="stylesheet" type="text/css" href="css/mainStyle.css" />
    </head>
    <body>
            <canvas id="renderCanvas"></canvas>
            <div class="example">
                <div id="drop_zone">Drop files here</div>
                <output id="file_list2"></output>
              </div>
              
              
              <output id="list"></output>
              <br>
              <br>
              <br>
              <output id="text"></output>
              <br>
              <br>
              <br>
            <p> Easy solution </p>
              <div class="intro-text">
                <input class="" type="file" id="file-input" accept="image/*" capture="" name="files[]" multiple="">
              </div>
            <script>
              function loadMeshData(string) {
                var lines = string.split("\n");
                var positions = [];
                var normals = [];
                var vertices = [];
              
                for ( var i = 0 ; i < lines.length ; i++ ) {
                  var parts = lines[i].trimRight().split(' ');
                  if ( parts.length > 0 ) {
                    switch(parts[0]) {
                      case 'v':  positions.push(
                        vec3.fromValues(
                          parseFloat(parts[1]),
                          parseFloat(parts[2]),
                          parseFloat(parts[3])
                        ));
                        break;
                      case 'vn':
                        normals.push(
                          vec3.fromValues(
                            parseFloat(parts[1]),
                            parseFloat(parts[2]),
                            parseFloat(parts[3])
                        ));
                        break;
                      case 'f': {
                        var f1 = parts[1].split('/');
                        var f2 = parts[2].split('/');
                        var f3 = parts[3].split('/');
                        Array.prototype.push.apply(vertices, positions[parseInt(f1[0]) - 1]);
                        Array.prototype.push.apply(vertices, normals[parseInt(f1[2]) - 1]);
                        Array.prototype.push.apply(vertices, positions[parseInt(f2[0]) - 1]);
                        Array.prototype.push.apply(vertices, normals[parseInt(f2[2]) - 1]);
                        Array.prototype.push.apply(vertices, positions[parseInt(f3[0]) - 1]);
                        Array.prototype.push.apply(vertices, normals[parseInt(f3[2]) - 1]);
                        break;
                      }
                    }
                  }
                }
                var vertexCount = vertices.length / 6;
                console.log("Loaded mesh with " + vertexCount + " vertices");
                return {
                  primitiveType: 'TRIANGLES',
                  vertices: new Float32Array(vertices),
                  vertexCount: vertexCount
                };
              }
                function handleFileSelect(evt) {
                    evt.stopPropagation();
                    evt.preventDefault();

                    var files = evt.dataTransfer.files; // FileList object.

                    // files is a FileList of File objects. List some properties.
                    var output = [];
                    var text = [];
                    var f = files[0];
                    output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                        f.size, ' bytes, last modified: ',
                        f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                        '</li>');
                    var reader = new FileReader();
                    reader.addEventListener('load', function() {
                            //alert('Contenu du fichier "' + f.name + '" :\n\n' + reader.result);
                            text.push(loadMeshData(reader.result).vertexCount); 
                            document.getElementById('text').innerHTML = '<p>' + text.join('') + '</p>';
                    });
                    reader.readAsText(f);
                    //text.push("loading");           
                    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
                    
            }

            function handleDragOver(evt) {
                evt.stopPropagation();
                evt.preventDefault();
                evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
            }

            // Setup the dnd listeners.
            var dropZone = document.getElementById('drop_zone');
            dropZone.addEventListener('dragover', handleDragOver, false);
            dropZone.addEventListener('drop', handleFileSelect, false);
            
        </script>
        
    </body>
    <!-- SCRIPTS BABYLON -->
    <script src="js/Game.js"></script>
    <script src="js/Player.js"></script>
    <script src="js/Arena.js"></script>
</html>